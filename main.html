<html>
  <head>
	<title>Lovemuseum</title>
	<meta http-equiv="content-type" content="text/html;charset=utf-8">
	  <link href="stylesheets/screen.css" media="all" rel="stylesheet">
	  <link href='http://fonts.googleapis.com/css?family=Quattrocento' rel='stylesheet' type='text/css'>


	  <!-- Loading Flat UI -->
	  <link href="dist/css/flat-ui.css" rel="stylesheet">
	  <link href="docs/assets/css/demo.css" rel="stylesheet">
	  <link rel="shortcut icon" href="img/favicon.ico">


	  <!-- bootstrapt -->
	  <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.2/jquery.min.js"></script>
	  <script type="text/javascript" src="js/bootstrap/bootstrap.min.js"></script>
	  <link rel="stylesheet" type="text/css" href="css/bootstrap/bootstrap.css" /> 
		
	  <!-- Loading Bootstrap -->
	  <!-- <link href="dist/css/vendor/bootstrap.min.css" rel="stylesheet"> -->
      
       <!-- Todo-parse Javascript -->
      <script src="http://code.jquery.com/jquery-2.0.3.min.js"></script>    	
      <script src="http://www.parsecdn.com/js/parse-1.2.13.min.js"></script>

	<!--(4.?)Parse資料庫，儲存照片、文字-->
		<script type="text/javascript">				
			Parse.initialize("19BDOaHH86XPBfrBbpr4skyC0efMHQQKRdYi2Dzt",
                             "zFnzw3ICGaSB9dVxHWr9tOTRzn15v79DU3l5Sv5Y");
           
             //base64 編碼的字串
            var base64 = "V29ya2luZyBhdCBQYXJzZSBpcyBncmVhdCE=";
            var file = new Parse.File("myfile.txt", { base64: base64 });
            
            //位元組值的陣列建立檔案
            var bytes = [ 0xBE, 0xEF, 0xCA, 0xFE ];
            var file = new Parse.File("myfile.txt", bytes);
            
            //點擊處理常式或其他函數中，取得該檔案的參考
            var fileUploadControl = $("#profilePhotoFileUpload")[0];
            if (fileUploadControl.files.length > 0) {
                var file = fileUploadControl.files[0];
                var name = "photo.jpg";
                var parseFile = new Parse.File(name, file);
            }
            
            parseFile.save().then(function() {
                // The file has been saved to Parse.
            }, function(error) {
                // The file either could not be read, or could not be saved to Parse.
            });
            
            
            
           
            function check(){
                
                var Story = Parse.Object.extend("Story");
                var Story = new Story();
                Story.save({
                Story:text.value,
                File:profilePhotoFileUpload.value,
                }, {
                success: function(Story) {
                	document.getElementById("upload").innerHTML="故事上傳成功!";
                    document.getElementById("st-tex").innerHTML= text.value;
                	document.getElementById("st-pic").innerHTML=  result.innerHTML;    
                },
                error: function(Story, error) {
                	document.getElementById("upload").innerHTML="故事上傳失敗!";
                    }
                });
  
                }
            
                // 以時間排序
                query.descending("updataAt");
        </script>
        
	</head>
	<body>
		<div class="wrapper">
            
             <!--  主畫面  -->
                  
       
            <div class="top-bar">
                <span class="main-logo">LoveMuseum</span>
                <div class="top-img">
                    <a href="#" ></a>
                </div>
            </div>  
                <div class="top-user">
                    <a href="我的個人頁面"></a>
                </div>
            
            <div class="main-message">
                <span class="user-name">移動薯條</span>
                    <div class="user-photo"></div>
                    
                <div  id="st-pic">
                    <!-- <a href="圖片"></a> -->
                </div>
                
                <p class="user-title" id="st-tex"></p>

                        
                <div class="main-comment">
                    <ul> 
                        <li>
                            <div class="po-photo">
                                <span class="po-a">第1個留言....</span> 
                            </div>
                            <div class="po-photo">
                                <span class="po-a">第2個留言~~~</span> 
                            </div>
                        </li>
                    </ul>
                    <form class="formb">   
                        <input type="text" placeholder="留言...." class="input-message">  
                        <div class="bn-comments">
                            <a  class="btn btn-block btn-lg btn-primary" >留言</a>
                        </div>
                    </form>
               </div>
            </div>
                </div>
            
			<!-- 新增文章按鈕 -->
			<div class="bn-newstory" class="btn btn-primary btn-lg" data-toggle="modal" data-target="#myModal">
			  <span>+</span>
			</div>

			<!-- 新增文章頁面 -->
			<div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
			  <div class="modal-dialog">
			  <div class="modal-content ">
			    <div class="modal-header">
			    <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
			    
			    </div>
			    <div class="modal-body">
			    <form action="new-story_submit" method="get" accept-charset="utf-8">
			     	<p> 
						<label>選擇圖片</label> 
						<input type="file" id="profilePhotoFileUpload" /> 
					</p>  
					<div id="result"></div>
			      	<textarea cols="30" rows="5" placeholder="輸入故事內容..." id="text"></textarea>
			    </form>
			    </div>
			    <div class="modal-footer">
			    
			    <div class="col-xs-3">
			       <a class="btn btn-block btn-lg btn-info" onclick="check()" data-toggle="modal" data-target="#load2">發佈</a>
			    </div>
			    </div>
			  </div>
			  </div>




			  <!-- loading頁面 -->

			  <div class="modal-dialog" id="load2" style="display: none;">
			  <div class="modal-content ">
			    <div class="modal-header">
			    <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
			    
			    </div>
			    <div class="modal-body">
			    	<div class="progress">
			    	  <div class="progress-bar progress-bar-danger progress-bar-striped" role="progressbar" aria-valuenow="100" aria-valuemin="0" aria-

valuemax="100" style="width: 100%">
			    	    <span class="sr-only">100% Complete (danger)</span>
			    	  </div>
			    	</div>
			    	<h1 id="upload"></h1>
			    </div>
			    <div class="modal-footer">
			</div>
		</div>


		
		<!-- 上傳圖片顯示 -->
			<script type="text/javascript">
				var result = document.getElementById("result"); 
				var input = document.getElementById("profilePhotoFileUpload"); 
				 
				if(typeof FileReader==='undefined'){ 
				   
				    input.setAttribute('disabled','disabled'); 
				}else{ 
				    input.addEventListener('change',readFile,false); 
				} 
				function readFile(){ 
				    var file = this.files[0]; 
				    if(!/image\/\w+/.test(file.type)){ 
				        alert("檔案錯了喔><"); 
				        return false; 
				    } 
				    var reader = new FileReader(); 
				    reader.readAsDataURL(file); 
				    reader.onload = function(e){ 
				        result.innerHTML = '<img src="'+this.result+'" alt=""/>' 
				    } 
				} 
			</script>
                  
                  
   
                  
  </body>

</html>