<html>
  <head>
	<title>Lovemuseum</title>
	<meta http-equiv="content-type" content="text/html;charset=utf-8">
	  <link href="stylesheets/screen.css" media="all" rel="stylesheet">
	  <link href='http://fonts.googleapis.com/css?family=Quattrocento' rel='stylesheet' type='text/css'>


	  <!-- Loading Flat UI -->
	  <link href="dist/css/flat-ui.css" rel="stylesheet">
	  <link href="docs/assets/css/demo.css" rel="stylesheet">
	  <link rel="shortcut icon" href="img/favicon.ico">


	  <!-- Loading Bootstrap -->
	  <!-- Bootstrap - CSS 巧瑜專用 -->
      <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.2/css/bootstrap.min.css">
      <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.2/css/bootstrap-theme.min.css">
      <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.2/js/bootstrap.min.js"></script>
      
      <!-- Bootstrap - Javascript(?)-->
	  <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.2/jquery.min.js"></script>
	  <script type="text/javascript" src="js/bootstrap/bootstrap.min.js"></script>
	  <link rel="stylesheet" type="text/css" href="css/bootstrap/bootstrap.css" /> 
      
      
      

	<!--(4.?)Parse資料庫，儲存照片、文字-->
		<script type="text/javascript">				
			Parse.initialize("19BDOaHH86XPBfrBbpr4skyC0efMHQQKRdYi2Dzt",
                             "zFnzw3ICGaSB9dVxHWr9tOTRzn15v79DU3l5Sv5Y");
           
             //base64 編碼的字串
            var base64 = "V29ya2luZyBhdCBQYXJzZSBpcyBncmVhdCE=";
            var file = new Parse.File("myfile.txt", { base64: base64 });
            
            //位元組值的陣列建立檔案
            var bytes = [ 0xBE, 0xEF, 0xCA, 0xFE ];
            var file = new Parse.File("myfile.txt", bytes);
            
            //點擊處理常式或其他函數中，取得該檔案的參考
            var fileUploadControl = $("#profilePhotoFileUpload")[0];
            if (fileUploadControl.files.length > 0) {
                var file = fileUploadControl.files[0];
                var name = "photo.jpg";
                var parseFile = new Parse.File(name, file);
            }
            
            parseFile.save().then(function() {
                // The file has been saved to Parse.
            }, function(error) {
                // The file either could not be read, or could not be saved to Parse.
            });
            
            
            function check(){
                var user = Parse.User.current();
                var fileUploadControl = $("#profilePhotoFileUpload")[0];
                if (fileUploadControl.files.length > 0) {
                    var file = fileUploadControl.files[0];
                    var name = "photo.jpg";
                    var parseFile = new Parse.File(name, file);
                    parseFile.save().then(function() {
                        var Story = new Parse.Object("Story");
                        Story.set("User", user);
                        Story.set("File", parseFile);
                        Story.set("Text", text.value);
                        Story.save(
                        {
                        }, {
                            success: function(Story) {
                                document.getElementById("upload").innerHTML="故事上傳成功!";
                                document.getElementById("load1").style.display = "none";
                                document.getElementById("storypost").style.display = "block";  
                            },
                            error: function(Story, error) {
                                document.getElementById("upload").innerHTML="故事上傳失敗!";
                            }
                        });
                        
                    }, function(error) {
                    });
                }
            };
            
            //取資料
            function Project(){
                var Story = Parse.Object.extend("Story");
                var query = new Parse.Query(Story);
                var descending = Story.updatedAt;
                query.descending("updatedAt");
                query.notEqualTo("Story", "Text","File");
                
                query.find({
                    success: function(results) {
                    for (var i = 0; i < results.length; i++) {
                    var object = results[i];

                  // 顯示故事
                                              
                    var pic = (object.get('File') + '- <img src="' +object.get("File")+ '"width="130px">'  +'<br/>');
                    var text = (object.get('Text') +'<br/>'); 
                    var template = $('.template').html();

                    template = template.replace("none", "block");
                    template = template.replace("$_storyImage", "<img src='" + pic[i] + "'>");
                    template = template.replace("$_storyMessage", text[i])
                    $('.frame').append(template);  
                    
                    
                     // var img = $("<img>").attr({
                     //              'src': 'http://l.yimg.com/mq/i/nws/mntl/20100317_FC_WingLee.jpg'
                     //          });
                     //          $("body").append(img);
                     //                  // $('.wrapper').append('<div id="storypost"></div>');
                                              
                     //  $(".wrapper").append(object.get('File') + '- <img src="' +object.get("File")+ '"width="130px">'  +'<br/>');
                    
                     //  $(".wrapper").append(object.id + ' - ' + object.get('Text') +'<br/>'); 
                     //  $(".wrapper").append(storypost.innerHTML);

                    
                    }
                },
                error: function(error) {
                alert("Error: " + error.code + " " + error.message);
                }
            });
            }
        </script>
        
	</head>
	<body onload="Project()">
		<div class="wrapper" id="main"> 
      <!--  主畫面  -->
      <nav class="top-bar">
        <p class="main-logo">LoveMuseum</p>
        <div class="top-img">
            <a href="#" ></a>
        </div>
      </nav>  
         <!-- 故事框 -->
                            
                               
      <div class="frame">
        <div class="template">
          <div class="post-story" id="storypost" style="display: none;">

            <div class="else-user-photo"></div>
            <span class="user-name">移動薯條</span>

            <div class="st-photo" id="st-pic">$_storyImage</div>
            
            <p id="st-tex" class="story-text">$_storyMessage</p>
            
            
            <div class="story-message">
              <div class="story-messager-photo"><h6>張香香</h6></div>                  
              <p class="story-messager-text">好奇妙的緣分!!!</p>
             </div>
            <div class="story-message">
              <div class="story-messager-photo"><h6>爆米花</h6></div>                  
              <p class="story-messager-text">注定要在一起的緣分~注定要在一起的緣分~注定要在一起的緣分</p>
             </div>
             <!--           <div class="main-comment">
                <ul> 
                    <li>
                        <div class="po-photo">
                            <span class="po-a">第1個留言....</span> 
                        </div>
                        <div class="po-photo">
                            <span class="po-a">第2個留言~~~</span> 
                        </div>
                    </li>
                </ul>   -->
             <div class="user-message">
               <input type="text" class="input-message">
               <div class="bn-comments">
                <a href="#fakelink" class="btn btn-info">留言</a>
               </div>
             </div>

          </div>
        </div>
      </div>                     
      

      
			<!-- 新增文章按鈕 -->
			<div class="bn-newstory" class="btn btn-primary btn-lg" data-toggle="modal" data-target="#myModal">
			  <span>+</span>
			</div>

			<!-- 新增文章頁面 -->

<!-- 			<div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
			  <div class="modal-dialog">
			  <div class="modal-content ">

			    <div class="modal-header">

            <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>

			    </div>

			    <div class="modal-body">

            <form action="new-story_submit" method="get" accept-charset="utf-8">
              <p> 
                <label>選擇圖片</label> 
                <input type="file" id="profilePhotoFileUpload" /> 
              </p>  
              <div id="result"></div>
              <textarea cols="30" rows="5" placeholder="輸入故事內容..." id="text"></textarea>
            </form>

			     </div>

			    
			    
            <div class="col-xs-3">
              <a class="btn btn-block btn-lg btn-info" onclick="check()" data-toggle="modal" data-target="#load2">發佈</a>
            </div>

			    
			  </div>
			  </div> -->
  <!-- loading頁面 -->

 <!--      <div class="modal-dialog" id="load2" style="display: none;">
        <div class="modal-content ">

          <div class="modal-header">
            <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
          </div>

          <div class="modal-body">
            <div class="progress">
              <div class="progress-bar progress-bar-danger progress-bar-striped" role="progressbar" aria-valuenow="100" aria-valuemin="0" aria-valuemax="100" style="width: 100%">
                <span class="sr-only">100% Complete (danger)</span>
              </div>
            </div>
            <h1 id="upload"></h1>
          </div>
        </div>

      </div>     

      </div> -->
<!-- 新增文章按鈕 -->

<div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
<!--            <div class="modal-dialog">-->
            <div class="newstory-page" id="load1">
<!--                <div class="modal-content">-->
                <div class="newstory-wall">
<!--                    <div class="modal-header">-->
                    <div class="newstory-header">
                        <span class="newstory-logo">LoveMuseum</span>
                    </div>
<!--                    <div class="modal-body">-->
                    <div class="newstory-body">
                        <button type="button" class="newstory-close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                        <form action="new-story_submit" method="get" accept-charset="utf-8">
                            <p>
                                <label>選擇圖片</label> 
                                <input type="file" id="profilePhotoFileUpload" /> 
                            </p>
                            <div id="result"></div>
                                <textarea cols="175" rows="5" placeholder="輸入故事內容..." id="text" class="input-story"></textarea>
                        </form>
                    </div>
<!--                    <div class="modal-footer">-->
                    <div class="newstory-footer">
                        <div class="bn-po">
                            <a class="btn btn-block btn-lg btn-info" onclick="check()" data-toggle="modal" data-target="#load2">發佈</a>
                        </div>
                    </div>
                </div>
            </div>
          <!-- loading頁面 -->

  <!--        <div class="modal-dialog" id="load2" style="display: none;">-->
                    <div class="londing-page" id="load2" style="display: none;">
  <!--              <div class="modal-content ">-->
                        <div class="newstory-wall"  >
  <!--          <div class="modal-header">-->
                            <div class="loding-header">
                                <span class="newstory-logo">LoveMuseum</span>
                                <button type="button" class="loding-close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                            </div>
  <!--          <div class="modal-body">-->
                            <div class="loding-body">
                                <div class="progress">
                                    <div class="progress-bar progress-bar-danger progress-bar-striped" role="progressbar" aria-valuenow="100" aria-valuemin="0" aria-valuemax="100" style="width: 100%">
                                        <span class="sr-only">100% Complete (danger)</span>
                                    </div>
                                </div>
                                <h1 id="upload">Loading......</h1>
                            </div>
                            <div class="modal-footer"></div>
                        </div>
                  </div>
</div>

			 


		
		<!-- 上傳圖片顯示 -->
    <script type="text/javascript">
      var result = document.getElementById("result"); 
      var input = document.getElementById("profilePhotoFileUpload"); 
      if(typeof FileReader==='undefined'){ 
         
          input.setAttribute('disabled','disabled'); 
      }else{ 
          input.addEventListener('change',readFile,false); 
      } 
      function readFile(){ 
          var file = this.files[0]; 
          if(!/image\/\w+/.test(file.type)){ 
              alert("檔案錯了喔><"); 
              return false; 
          } 
          var reader = new FileReader(); 
          reader.readAsDataURL(file); 

          reader.onload = function(e){ 
              result.innerHTML = '<img src="'+this.result+'" alt=""/>' 
          } 

      } 
    </script>
     
                  
   
                  
  </body>

</html>

<!--宥宥要編輯 新增故事框架
var file = result.innerHTML; 
                  var tex = text.value; 
                  var html = 
                  "
                  <div id="storypost" class="main-message" style="display: none;">
                  <span class="user-name">移動薯條</span>
                  <div class="user-photo"></div>
                  
                  <div id="st-pic">" + file + "</div>
              
                  <p class="user-title" id="st-tex">" + tex + "</p>
          </div>
          " -->